### 应用污点(yaml)
[root@master01 ~]# kubectl apply -f http://mgmtcentos.qytanghost.com/taints/node-taints.yaml
Warning: resource nodes/node01.qytanghost.com is missing the kubectl.kubernetes.io/last-applied-configuration annotation which is required by kubectl apply. kubectl apply sld only be used on resources created declaratively by either kubectl create --save-config or kubectl apply. The missing annotation will be patched automatically.
node/node01.qytanghost.com configured


### 应用污点(kubectl)
[root@master01 ~]# kubectl taint nodes node01.qytanghost.com cpu=i9:NoSchedule
node/node01.qytanghost.com tainted

### 安装jq
```shell
yum install -y jq

```
### 查看污点
[root@master01 ~]# kubectl get node node01.qytanghost.com -o json | jq '.spec.taints'
[
  {
    "effect": "NoSchedule",
    "key": "cpu",
    "value": "i9"
  },
  {
    "effect": "NoSchedule",
    "key": "disk",
    "value": "ssd"
  }
]

### 删除污点(kubectl)
[root@master01 ~]# kubectl taint nodes node01.qytanghost.com cpu-
node/node01.qytanghost.com untainted

### 确认污点cpu已经被删除
[root@master01 ~]# kubectl get node node01.qytanghost.com -o json | jq '.spec.taints'
[
  {
    "effect": "NoSchedule",
    "key": "disk",
    "value": "ssd"
  }
]

### 应用不能容忍污点的dp
[root@master01 ~]# kubectl apply -f http://mgmtcentos.qytanghost.com/taints/no-tolerations.yaml
deployment.apps/no-tolerations created

[root@master01 ~]# kubectl get pods -o wide
NAME                                         READY   STATUS    RESTARTS   AGE     IP              NODE                    NOMINATED NODE   READINESS GATES
no-tolerations-58797c8cd8-5llxk              1/1     Running   0          32s     172.16.202.9    node02.qytanghost.com   <none>           <none>
no-tolerations-58797c8cd8-lrvcf              1/1     Running   0          32s     172.16.202.8    node02.qytanghost.com   <none>           <none>
no-tolerations-58797c8cd8-nq4c8              1/1     Running   0          32s     172.16.202.10   node02.qytanghost.com   <none>           <none>


### 配置calico deployment calico-typha 容忍污点
```shell script
      tolerations:
        - operator: Exists
          effect: NoSchedule
        - operator: Exists
          effect: NoExecute
        - key: CriticalAddonsOnly
          operator: Exists
        ~~~ 下面部分是添加的 ~~~  
        - key: disk
          operator: Equal
          value: ssd
          effect: NoSchedule
```

### 应用容忍污点的dp
[root@master01 ~]# kubectl apply -f http://mgmtcentos.qytanghost.com/taints/tolerations.yaml
deployment.apps/tolerations created

[root@master01 ~]# kubectl get pod -o wide
NAME                                         READY   STATUS    RESTARTS   AGE     IP              NODE                    NOMINATED NODE   READINESS GATES
no-tolerations-58797c8cd8-5llxk              1/1     Running   0          13m     172.16.202.9    node02.qytanghost.com   <none>           <none>
no-tolerations-58797c8cd8-lrvcf              1/1     Running   0          13m     172.16.202.8    node02.qytanghost.com   <none>           <none>
no-tolerations-58797c8cd8-nq4c8              1/1     Running   0          13m     172.16.202.10   node02.qytanghost.com   <none>           <none>

tolerations-79d4f765c6-lsfz4                 1/1     Running   0          12s     172.16.201.36   node01.qytanghost.com   <none>           <none>
tolerations-79d4f765c6-r4rzw                 1/1     Running   0          12s     172.16.201.38   node01.qytanghost.com   <none>           <none>
tolerations-79d4f765c6-xjptg                 1/1     Running   0          12s     172.16.201.37   node01.qytanghost.com   <none>           <none>


### 一定要去掉污点
[root@master01 ~]# kubectl taint nodes node01.qytanghost.com disk-
node/node01.qytanghost.com untainted

